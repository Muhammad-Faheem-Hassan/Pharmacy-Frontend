<div class="container">
  <h2 class="mb-4">Purchase Entry</h2>

  <form [formGroup]="purchaseForm" (ngSubmit)="submitPurchase()">
    <div class="row g-3">
      <div class="col-md-4 mb-3">
        <label class="form-label">Supplier Name</label>
        <select class="form-select" formControlName="supplierId">
          <option value="" disabled selected>Select Supplier</option>
          <option *ngFor="let supplier of suppliers" [value]="supplier._id">
            {{ supplier.name }}
          </option>
        </select>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Date</label>
        <input type="date" class="form-control" formControlName="date" />
      </div>
    </div>

    <div formArrayName="items">
      <h4>Items</h4>

      <div *ngFor="let item of items.controls; let i = index" [formGroupName]="i" class="row g-3 mb-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label">Medicine</label>
          <select class="form-select" formControlName="medicine">
            <option value="" disabled selected>Select Medicine</option>
            <option *ngFor="let medicine of medicines" [value]="medicine._id">
              {{ medicine.name }} ({{ medicine.batchNumber }})
            </option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">Quantity</label>
          <input type="number" class="form-control" formControlName="quantity" (input)="updateTotal()" />
        </div>
        <div class="col-md-2">
          <label class="form-label">Price</label>
          <input type="number" class="form-control" formControlName="price" (input)="updateTotal()" />
        </div>
        <div class="col-md-2">
          <label class="form-label">Sale Price</label>
          <input type="number" class="form-control" formControlName="salePrice" (input)="updateTotal()" />
        </div>
        <div class="col-md-2 text-end">
          <div class="d-flex flex-row">
            <button type="button" class="btn btn-danger" (click)="removeItem(i)">
              Remove
            </button>
            <button *ngIf="i === items.controls.length - 1" type="button" class="btn btn-secondary ms-1"
              (click)="addItem()">
              <i class="bi bi-plus-lg me-1"></i> Add
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-3">
      <strong>Total:</strong> Rs {{ purchaseForm.get('totalAmount')?.value }}
    </div>

    <div class="mt-3">
      <button class="btn btn-primary" type="submit" [disabled]="purchaseForm.invalid">
        Submit Purchase
      </button>
    </div>
  </form>
</div>